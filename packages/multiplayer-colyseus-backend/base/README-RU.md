# @universo/multiplayer-colyseus-backend

> üèóÔ∏è **–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –ø–∞–∫–µ—Ç** - TypeScript-first –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å Colyseus multiplayer —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–æ–º

–ú–Ω–æ–≥–æ–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Å–µ—Ä–≤–µ—Ä —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è –∫–æ—Å–º–∏—á–µ—Å–∫–∏—Ö –∏–≥—Ä–æ–≤—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ Universo MMOOMM.

## –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–∞–∫–µ—Ç–µ

- **–í–µ—Ä—Å–∏—è**: 0.1.0
- **–¢–∏–ø**: Multiplayer Server Package (TypeScript)
- **–°—Ç–∞—Ç—É—Å**: ‚úÖ –ê–∫—Ç–∏–≤–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
- **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**: –°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è —Å Colyseus + WebSocket —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–æ–º

## –ö–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

### –ú–Ω–æ–≥–æ–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∏–≥—Ä–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- –î–æ 16 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏–≥—Ä–æ–∫–æ–≤ –≤ –∫–æ–º–Ω–∞—Ç–µ
- –°–≤—è–∑—å –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –±–∞–∑–µ WebSocket
- –°–µ—Ä–≤–µ—Ä–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º —Å –∞–≤—Ç–æ—Ä–∏—Ç–µ—Ç–Ω–æ—Å—Ç—å—é
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ–∑–∏—Ü–∏–π –∏ –¥–µ–π—Å—Ç–≤–∏–π —Å –Ω–∏–∑–∫–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π

### –ì–µ–π–º–ø–ª–µ–π MMOOMM
- **–°–∏—Å—Ç–µ–º–∞ –¥–æ–±—ã—á–∏**: –í–∞–ª–∏–¥–∏—Ä—É–µ–º–∞—è —Å–µ—Ä–≤–µ—Ä–æ–º –º–µ—Ö–∞–Ω–∏–∫–∞ –¥–æ–±—ã—á–∏ –∞—Å—Ç–µ—Ä–æ–∏–¥–æ–≤
- **–¢–æ—Ä–≥–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞**: –ü—Ä–æ–¥–∞–∂–∞ —Ä–µ—Å—É—Ä—Å–æ–≤ –Ω–∞ —Å—Ç–∞–Ω—Ü–∏—è—Ö —Å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ–º –∫—Ä–µ–¥–∏—Ç–æ–≤
- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—É—â–Ω–æ—Å—Ç—è–º–∏**: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∞—Å—Ç–µ—Ä–æ–∏–¥—ã, —Å—Ç–∞–Ω—Ü–∏–∏ –∏ –≤—Ä–∞—Ç–∞
- **–°–∏—Å—Ç–µ–º–∞ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è**: –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
- **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è**: –¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ —Å—Ö–µ–º—ã —Å Colyseus
- **–ó–∞—â–∏—Ç–∞ –æ—Ç —á–∏—Ç–µ—Ä—Å—Ç–≤–∞**: –°–µ—Ä–≤–µ—Ä–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–∑–∏—Ü–∏–π –∏ –¥–µ–π—Å—Ç–≤–∏–π
- **–ì—Ä–∞—Ü–∏–æ–∑–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–º–Ω–∞—Ç —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏
- **–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏**: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≥–æ—Ä—è—á–µ–π –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ –∏ –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏–∑ –∫–æ—Ä–Ω—è workspace
pnpm install

# –°–±–æ—Ä–∫–∞ –ø–∞–∫–µ—Ç–∞
pnpm --filter @universo/multiplayer-colyseus-backend build
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –°–µ—Ä–≤–µ—Ä —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
```bash
# –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Å –≥–æ—Ä—è—á–µ–π –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–æ–π
pnpm --filter @universo/multiplayer-colyseus-backend dev

# –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–∞ ws://localhost:2567
# –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ñ–∞–π–ª–æ–≤
```

### –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
```bash
# –°–±–æ—Ä–∫–∞ TypeScript –≤ JavaScript
pnpm --filter @universo/multiplayer-colyseus-backend build

# –ó–∞–ø—É—Å–∫ –ø—Ä–æ–¥–∞–∫—à–Ω —Å–µ—Ä–≤–µ—Ä–∞
pnpm --filter @universo/multiplayer-colyseus-backend start
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å PlayCanvas
```typescript
// –ü—Ä–∏–º–µ—Ä –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –∫–ª–∏–µ–Ω—Ç–∞
import { Client } from 'colyseus.js'

const client = new Client('ws://localhost:2567')
const room = await client.joinOrCreate('mmoomm', { 
  playerName: '–ö–æ—Å–º–∏—á–µ—Å–∫–∏–π–ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å',
  startPosition: { x: 0, y: 2, z: 0 }
})

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π —Å–æ—Å—Ç–æ—è–Ω–∏—è
room.onStateChange((state) => {
  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–≤–æ–≥–æ –º–∏—Ä–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
  updatePlayers(state.players)
  updateEntities(state.entities)
})
```

## –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ API

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–æ–º–Ω–∞—Ç—ã
- **ID –∫–æ–º–Ω–∞—Ç—ã**: `mmoomm`
- **–ú–∞–∫—Å–∏–º—É–º –∏–≥—Ä–æ–∫–æ–≤**: 16 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏–≥—Ä–æ–∫–æ–≤
- **–ü–æ—Ä—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é**: 2567 (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è)
- **–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç**: WebSocket —Å —Ä–µ–∑–µ—Ä–≤–Ω—ã–º–∏ –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏

### –û–ø—Ü–∏–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
```typescript
interface JoinOptions {
  playerName?: string        // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–µ –∏–º—è –∏–≥—Ä–æ–∫–∞
  name?: string             // –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ –ø–æ–ª–µ –∏–º–µ–Ω–∏ (—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å)
  startPosition?: {         // –ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è
    x: number
    y: number  
    z: number
  }
  entities?: EntityData[]   // –î–∞–Ω–Ω—ã–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å—É—â–Ω–æ—Å—Ç–µ–π UPDL
}

// –ü—Ä–∏–º–µ—Ä –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
const room = await client.joinOrCreate('mmoomm', {
  playerName: '–ö–æ–º–∞–Ω–¥–∏—Ä–ö–æ—Å–º–æ—Å–∞',
  startPosition: { x: 10, y: 2, z: -15 }
})
```

### –ü—Ä–æ—Ç–æ–∫–æ–ª —Å–æ–æ–±—â–µ–Ω–∏–π

#### –°–æ–æ–±—â–µ–Ω–∏—è –ö–ª–∏–µ–Ω—Ç ‚Üí –°–µ—Ä–≤–µ—Ä
```typescript
// –î–≤–∏–∂–µ–Ω–∏–µ –∏ –ø–æ–≤–æ—Ä–æ—Ç –∏–≥—Ä–æ–∫–∞
room.send('updateTransform', {
  x: number,
  y: number, 
  z: number,
  rotX: number,
  rotY: number,
  rotZ: number
})

// –ù–∞—á–∞—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ –¥–æ–±—ã—á–∏ –≤ —Ç–µ–∫—É—â–µ–π –ø–æ–∑–∏—Ü–∏–∏
room.send('startMining', {
  targetEntityId?: string  // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π ID –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∞—Å—Ç–µ—Ä–æ–∏–¥–∞
})

// –ü—Ä–æ–¥–∞—Ç—å –≤–µ—Å—å –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å –Ω–∞ –±–ª–∏–∂–∞–π—à–µ–π —Ç–æ—Ä–≥–æ–≤–æ–π —Å—Ç–∞–Ω—Ü–∏–∏
room.send('sellAll', {
  stationId?: string      // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π ID –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Å—Ç–∞–Ω—Ü–∏–∏
})
```

#### –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –°–µ—Ä–≤–µ—Ä ‚Üí –ö–ª–∏–µ–Ω—Ç
```typescript
// –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è —á–µ—Ä–µ–∑ —Å—Ö–µ–º—ã Colyseus
room.onStateChange((state) => {
  // –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–≥—Ä–æ–∫–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
  state.players.forEach((player, sessionId) => {
    updatePlayerPosition(sessionId, player.x, player.y, player.z)
    updatePlayerInventory(sessionId, player.inventory, player.credits)
  })
  
  // –û–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å—É—â–Ω–æ—Å—Ç–µ–π
  state.entities.forEach((entity, entityId) => {
    updateEntityState(entityId, entity.type, entity.position, entity.data)
  })
})
```

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
```
src/
‚îú‚îÄ‚îÄ index.ts              # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞
‚îú‚îÄ‚îÄ rooms/
‚îÇ   ‚îî‚îÄ‚îÄ MMOOMMRoom.ts     # –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –º–Ω–æ–≥–æ–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π –∫–æ–º–Ω–∞—Ç—ã
‚îú‚îÄ‚îÄ schemas/              # –¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ PlayerSchema.ts   # –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä–æ–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ EntitySchema.ts   # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∏–≥—Ä–æ–≤—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π
‚îÇ   ‚îî‚îÄ‚îÄ MMOOMMRoomState.ts # –ü–æ–ª–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã
‚îú‚îÄ‚îÄ integration/          # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏
‚îú‚îÄ‚îÄ utils/                # –û–±—â–∏–µ —É—Ç–∏–ª–∏—Ç—ã
‚îî‚îÄ‚îÄ tests/                # –¢–µ—Å—Ç–æ–≤—ã–µ –Ω–∞–±–æ—Ä—ã
```

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
```typescript
// –ò–µ—Ä–∞—Ä—Ö–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–æ–º–Ω–∞—Ç—ã
MMOOMMRoomState {
  players: Map<string, PlayerSchema>     // –í—Å–µ –ø–æ–¥–∫–ª—é—á—ë–Ω–Ω—ã–µ –∏–≥—Ä–æ–∫–∏
  entities: Map<string, EntitySchema>    // –°—É—â–Ω–æ—Å—Ç–∏ –∏–≥—Ä–æ–≤–æ–≥–æ –º–∏—Ä–∞
  currentPlayers: number                 // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∏–≥—Ä–æ–∫–æ–≤
  roomSettings: RoomConfig               // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–æ–º–Ω–∞—Ç—ã
}

// –°—Ö–µ–º–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä–æ–∫–∞
PlayerSchema {
  name: string          // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–µ –∏–º—è
  x, y, z: number      // 3D –ø–æ–∑–∏—Ü–∏—è
  rotX, rotY, rotZ: number  // –ü–æ–≤–æ—Ä–æ—Ç
  inventory: number     // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ—Å—É—Ä—Å–æ–≤
  credits: number       // –¢–æ—Ä–≥–æ–≤–∞—è –≤–∞–ª—é—Ç–∞
  lastActivity: number  // –í—Ä–µ–º–µ–Ω–Ω–∞—è –º–µ—Ç–∫–∞ –ø—Ä–æ—Ç–∏–≤ –±–µ–∑–¥–µ–π—Å—Ç–≤–∏—è
}
```

### –ò–≥—Ä–æ–≤—ã–µ —Å–∏—Å—Ç–µ–º—ã
- **–°–∏—Å—Ç–µ–º–∞ –¥–≤–∏–∂–µ–Ω–∏—è**: –í–∞–ª–∏–¥–∏—Ä—É–µ–º—ã–µ —Å–µ—Ä–≤–µ—Ä–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏–π —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –≥—Ä–∞–Ω–∏—Ü
- **–°–∏—Å—Ç–µ–º–∞ –¥–æ–±—ã—á–∏**: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ –∞—Å—Ç–µ—Ä–æ–∏–¥–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –±–ª–∏–∑–æ—Å—Ç–∏
- **–¢–æ—Ä–≥–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞**: –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è –≤ –∫—Ä–µ–¥–∏—Ç—ã –Ω–∞ —Å—Ç–∞–Ω—Ü–∏—è—Ö
- **–ó–∞—â–∏—Ç–∞ –æ—Ç —á–∏—Ç–µ—Ä—Å—Ç–≤–∞**: –°–µ—Ä–≤–µ—Ä–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π –∏–≥—Ä–æ–∫–æ–≤

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —à–∞–±–ª–æ–Ω–æ–º PlayCanvas
–≠—Ç–æ—Ç —Å–µ—Ä–≤–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è —Å —à–∞–±–ª–æ–Ω–∞–º–∏ MMOOMM PlayCanvas –∫–æ–≥–¥–∞:
- Space –∏–º–µ–µ—Ç —Å–≤–æ–π—Å—Ç–≤–æ `collectLeadName=true`
- –ü–æ–¥–∫–ª—é—á—ë–Ω–Ω—ã–π Space —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –º–µ—Ç–∞–≤—Å–µ–ª–µ–Ω–Ω–æ–π
- –ú–Ω–æ–≥–æ–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Ä–µ–∂–∏–º –≤–∫–ª—é—á—ë–Ω –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –∏–≥—Ä—ã

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å—É—â–Ω–æ—Å—Ç–µ–π UPDL
```typescript
// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–º–Ω–∞—Ç—ã —Å —Å—É—â–Ω–æ—Å—Ç—è–º–∏ UPDL
const room = await client.joinOrCreate('mmoomm', {
  entities: [
    { id: 'asteroid-1', type: 'asteroid', position: [10, 0, 20], data: { resources: 100 } },
    { id: 'station-1', type: 'station', position: [0, 0, 0], data: { tradingRates: { ore: 10 } } }
  ]
})
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```bash
# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–µ—Ä–∞
PORT=2567                              # –ü–æ—Ä—Ç —Å–µ—Ä–≤–µ—Ä–∞
MULTIPLAYER_SERVER_PORT=2567           # –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –ø–æ—Ä—Ç–∞
COLYSEUS_PORT=2567                     # –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–π –¥–ª—è Colyseus –ø–æ—Ä—Ç
NODE_ENV=development                   # –†–µ–∂–∏–º –æ–∫—Ä—É–∂–µ–Ω–∏—è

# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Redis (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
REDIS_URL=redis://localhost:6379       # –î–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è —Å Redis presence

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
COLYSEUS_MONITOR_PORT=2568             # –ü–æ—Ä—Ç –ø–∞–Ω–µ–ª–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
COLYSEUS_MONITOR_SECRET=your-secret    # –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–º–Ω–∞—Ç—ã
```typescript
// –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–º–Ω–∞—Ç—ã
const roomConfig = {
  maxClients: 16,           // –ú–∞–∫—Å–∏–º—É–º –∏–≥—Ä–æ–∫–æ–≤ –≤ –∫–æ–º–Ω–∞—Ç–µ
  patchRate: 20,            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–π —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ —Å–µ–∫—É–Ω–¥—É (50–º—Å)
  simulationInterval: 16.6, // –ß–∞—Å—Ç–æ—Ç–∞ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–≥–æ —Ç–∏–∫–∞ (60fps)
  autoDispose: true,        // –ê–≤—Ç–æ-–æ—á–∏—Å—Ç–∫–∞ –ø—É—Å—Ç—ã—Ö –∫–æ–º–Ω–∞—Ç
  presence: 'redis'         // –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ —Å Redis (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
}
```

## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Node.js 18+
- pnpm 8+
- TypeScript 5+
- Redis (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è)

### –î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã
```bash
# –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞
pnpm dev                # –ó–∞–ø—É—Å–∫ —Å –≥–æ—Ä—è—á–µ–π –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–æ–π
pnpm build              # –ö–æ–º–ø–∏–ª—è—Ü–∏—è TypeScript
pnpm start              # –ó–∞–ø—É—Å–∫ –ø—Ä–æ–¥–∞–∫—à–Ω —Å–µ—Ä–≤–µ—Ä–∞
pnpm clean              # –û—á–∏—Å—Ç–∫–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Å–±–æ—Ä–∫–∏

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
pnpm test               # –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –Ω–∞–±–æ—Ä–∞ Jest
pnpm test:watch         # –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –≤ —Ä–µ–∂–∏–º–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è

# –£—Ç–∏–ª–∏—Ç—ã
pnpm type-check         # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤ TypeScript
```

### –ü—Ä–æ—Ü–µ—Å—Å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
```bash
# –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
pnpm --filter @universo/multiplayer-colyseus-backend dev

# –í –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä Colyseus –Ω–∞ http://localhost:2568 (–µ—Å–ª–∏ –≤–∫–ª—é—á—ë–Ω)
# –ò–ª–∏ –ø–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∏–≥—Ä–æ–≤—ã–º –∫–ª–∏–µ–Ω—Ç–æ–º –∫ ws://localhost:2567
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```
src/
‚îú‚îÄ‚îÄ index.ts              # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ —Å–µ—Ä–≤–µ—Ä–∞
‚îú‚îÄ‚îÄ rooms/
‚îÇ   ‚îî‚îÄ‚îÄ MMOOMMRoom.ts     # –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä–æ–≤–æ–π –∫–æ–º–Ω–∞—Ç—ã
‚îú‚îÄ‚îÄ schemas/              # Colyseus state —Å—Ö–µ–º—ã
‚îÇ   ‚îú‚îÄ‚îÄ PlayerSchema.ts   # –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –∏–≥—Ä–æ–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ EntitySchema.ts   # –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏–≥—Ä–æ–≤–æ–π —Å—É—â–Ω–æ—Å—Ç–∏
‚îÇ   ‚îî‚îÄ‚îÄ MMOOMMRoomState.ts # –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–æ–º–Ω–∞—Ç—ã
‚îú‚îÄ‚îÄ integration/          # –í–Ω–µ—à–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
‚îÇ   ‚îî‚îÄ‚îÄ updl.ts          # –ó–∞–≥—Ä—É–∑–∫–∞ UPDL —Å—É—â–Ω–æ—Å—Ç–µ–π
‚îú‚îÄ‚îÄ utils/               # –û–±—â–∏–µ —É—Ç–∏–ª–∏—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ validation.ts    # –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îî‚îÄ‚îÄ gameLogic.ts     # –ò–≥—Ä–æ–≤–∞—è –º–µ—Ö–∞–Ω–∏–∫–∞
‚îî‚îÄ‚îÄ tests/               # –¢–µ—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã
    ‚îú‚îÄ‚îÄ room.test.ts     # –¢–µ—Å—Ç—ã —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ –∫–æ–º–Ω–∞—Ç—ã
    ‚îî‚îÄ‚îÄ integration.test.ts # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç–æ–≤—ã–π –Ω–∞–±–æ—Ä
```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
pnpm --filter @universo/multiplayer-colyseus-backend test

# –ó–∞–ø—É—Å–∫ —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º
pnpm --filter @universo/multiplayer-colyseus-backend test -- --coverage

# –ó–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ñ–∞–π–ª–∞
pnpm test -- room.test.ts
```

### –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏
- **–ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –∫–æ–º–Ω–∞—Ç—ã**: –°–æ–∑–¥–∞–Ω–∏–µ, –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ/–æ—Ç–∫–ª—é—á–µ–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π**: –í—Å–µ —Ç–∏–ø—ã –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è**: –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–≥—Ä–æ–∫–æ–≤ –∏ —Å—É—â–Ω–æ—Å—Ç–µ–π
- **–ò–≥—Ä–æ–≤–∞—è –ª–æ–≥–∏–∫–∞**: –î–æ–±—ã—á–∞, —Ç–æ—Ä–≥–æ–≤–ª—è, –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–≤–∏–∂–µ–Ω–∏—è
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**: –ó–∞–≥—Ä—É–∑–∫–∞ —Å—É—â–Ω–æ—Å—Ç–µ–π UPDL, —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å PlayCanvas

### –ü—Ä–∏–º–µ—Ä —Ç–µ—Å—Ç–∞
```typescript
describe('MMOOMMRoom', () => {
  test('–∏–≥—Ä–æ–∫–∏ –º–æ–≥—É—Ç –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∏ –ø–æ–ª—É—á–∏—Ç—å –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ', async () => {
    const room = new MMOOMMRoom()
    await room.onCreate({})
    
    const client = { sessionId: 'test-123' }
    room.onJoin(client, { playerName: 'TestPlayer' })
    
    expect(room.state.players.has('test-123')).toBe(true)
    expect(room.state.currentPlayers).toBe(1)
  })
})
```

## –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ

### –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Docker
```dockerfile
FROM node:18-alpine
WORKDIR /app

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
COPY package*.json ./
RUN pnpm install --prod

# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–æ–¥–∞
COPY dist/ ./dist/

# –û—Ç–∫—Ä—ã—Ç–∏–µ –ø–æ—Ä—Ç–∞
EXPOSE 2567

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è
HEALTHCHECK --interval=30s --timeout=3s --start-period=5s --retries=3 \
  CMD curl -f http://localhost:2567/health || exit 1

CMD ["node", "dist/index.js"]
```

### –°–æ–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
- **–ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Redis presence –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞–º–∏
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –í–∫–ª—é—á–∏—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä Colyseus –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∫–æ–º–Ω–∞—Ç –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —á–∞—Å—Ç–æ—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —á–∞—Å—Ç–æ—Ç—ã –ø–∞—Ç—á–µ–π –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∏–≥—Ä—ã

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
```typescript
// –î–æ—Å—Ç—É–ø –∫ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ –∫–æ–º–Ω–∞—Ç
console.log(`–ê–∫—Ç–∏–≤–Ω—ã—Ö –∫–æ–º–Ω–∞—Ç: ${gameServer.presence.totalRooms}`)
console.log(`–ü–æ–¥–∫–ª—é—á—ë–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤: ${gameServer.presence.totalClients}`)

// –ú–µ—Ç—Ä–∏–∫–∏ –ø–æ –∫–æ–º–Ω–∞—Ç–µ
room.onMessage('getStats', (client) => {
  client.send('stats', {
    players: room.state.currentPlayers,
    entities: room.state.entities.size,
    uptime: Date.now() - room.createdAt
  })
})
```

### –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã –∑–¥–æ—Ä–æ–≤—å—è
```typescript
// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–¥–æ—Ä–æ–≤—å—è
app.get('/health', (req, res) => {
  res.json({
    status: 'healthy',
    rooms: gameServer.presence.totalRooms,
    clients: gameServer.presence.totalClients,
    uptime: process.uptime()
  })
})
```

## –°–≤—è–∑–∞–Ω–Ω—ã–µ –ø–∞–∫–µ—Ç—ã
- [`@universo/template-mmoomm`](../template-mmoomm/base/README.md) - –®–∞–±–ª–æ–Ω –∏–≥—Ä—ã PlayCanvas
- [`@universo/spaces-frontend`](../spaces-frontend/base/README.md) - –§—Ä–æ–Ω—Ç–µ–Ω–¥ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞–º–∏
- [`@universo/utils`](../universo-utils/base/README.md) - –û–±—â–∏–µ —É—Ç–∏–ª–∏—Ç—ã

---
*–ß–∞—Å—Ç—å [Universo Platformo](../../../README-RU.md) - –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–µ—Ç–∞–≤—Å–µ–ª–µ–Ω–Ω—ã–º–∏*
