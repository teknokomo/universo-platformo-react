# @universo/metahubs-backend

> üèóÔ∏è **–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –ø–∞–∫–µ—Ç** - TypeScript-first –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å Express.js –∏ TypeORM

–ë—ç–∫–µ–Ω–¥-—Å–µ—Ä–≤–∏—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–µ—Ç–∞—Ö–∞–±–∞–º–∏, –º–µ—Ç–∞-—Ä–∞–∑–¥–µ–ª–∞–º–∏, –º–µ—Ç–∞-—Å—É—â–Ω–æ—Å—Ç—è–º–∏ –∏ —á–ª–µ–Ω—Å—Ç–≤–æ–º —Å–æ —Å—Ç—Ä–æ–≥–æ–π –∏–∑–æ–ª—è—Ü–∏–µ–π –Ω–∞ —É—Ä–æ–≤–Ω–µ –º–µ—Ç–∞—Ö–∞–±–∞.

## –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–∞–∫–µ—Ç–µ

- **–í–µ—Ä—Å–∏—è**: 0.1.0
- **–¢–∏–ø**: Backend Service Package (TypeScript)
- **–°—Ç–∞—Ç—É—Å**: ‚úÖ –ê–∫—Ç–∏–≤–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
- **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**: Express.js + TypeORM + Zod

## –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –î–æ–º–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å
- **–ú–µ—Ç–∞—Ö–∞–±—ã**: –í–µ—Ä—Ö–Ω–µ—É—Ä–æ–≤–Ω–µ–≤—ã–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–æ–Ω–Ω—ã–µ –µ–¥–∏–Ω–∏—Ü—ã —Å –ø–æ–ª–Ω–æ–π –∏–∑–æ–ª—è—Ü–∏–µ–π –¥–∞–Ω–Ω—ã—Ö
- **–ú–µ—Ç–∞-—Ä–∞–∑–¥–µ–ª—ã**: –õ–æ–≥–∏—á–µ—Å–∫–∏–µ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏, –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã–µ –∫ –º–µ—Ç–∞—Ö–∞–±–∞–º
- **–ú–µ—Ç–∞-—Å—É—â–Ω–æ—Å—Ç–∏**: –û—Ç–¥–µ–ª—å–Ω—ã–µ –∞–∫—Ç–∏–≤—ã, –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã–µ –∫ –º–µ—Ç–∞-—Ä–∞–∑–¥–µ–ª–∞–º –∏ –º–µ—Ç–∞—Ö–∞–±–∞–º
- **–ß–ª–µ–Ω—Å—Ç–≤–æ**: –ß–ª–µ–Ω—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –º–µ—Ç–∞—Ö–∞–±–µ —Å —Ä–æ–ª—è–º–∏ –∏ –ø—Ä–∞–≤–∞–º–∏
- **–¢–∞–±–ª–∏—Ü—ã —Å–≤—è–∑–µ–π**: –û—Ç–Ω–æ—à–µ–Ω–∏—è –º–Ω–æ–≥–∏–µ-–∫–æ-–º–Ω–æ–≥–∏–º —Å CASCADE —É–¥–∞–ª–µ–Ω–∏–µ–º –∏ UNIQUE –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏

### –ò–∑–æ–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- –ü–æ–ª–Ω–∞—è –∏–∑–æ–ª—è—Ü–∏—è –º–µ—Ç–∞—Ö–∞–±–æ–≤ ‚Äî –Ω–µ—Ç –º–µ–∂–º–µ—Ç–∞—Ö–∞–±–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º
- –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –∞—Å—Å–æ—Ü–∏–∞—Ü–∏–∏ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—é—Ç –ø–æ—è–≤–ª–µ–Ω–∏–µ ¬´—Å–∏—Ä–æ—Ç—Å–∫–∏—Ö¬ª —Å—É—â–Ω–æ—Å—Ç–µ–π
- –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–≤—è–∑—è–º–∏
- –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö —Å –ø–æ–Ω—è—Ç–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ –æ–± –æ—à–∏–±–∫–∞—Ö
- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å guard-–∞–º–∏ –º–µ—Ç–∞—Ö–∞–±–∞/–º–µ—Ç–∞-—Ä–∞–∑–¥–µ–ª–∞/–º–µ—Ç–∞-—Å—É—â–Ω–æ—Å—Ç–∏
- –ó–∞—â–∏—Ç–∞ –æ—Ç DoS-–∞—Ç–∞–∫ —á–µ—Ä–µ–∑ rate limiting

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
- –ü–∞—Ç—Ç–µ—Ä–Ω TypeORM Repository –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å –¥–∞–Ω–Ω—ã–º–∏
- PostgreSQL —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π JSONB –¥–ª—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
- –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π —Ä–µ–µ—Å—Ç—Ä
- CASCADE —É–¥–∞–ª–µ–Ω–∏–µ —Å–≤—è–∑–µ–π —Å UNIQUE –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏–∑ –∫–æ—Ä–Ω—è workspace
pnpm install

# –°–±–æ—Ä–∫–∞ –ø–∞–∫–µ—Ç–∞
pnpm --filter @universo/metahubs-backend build
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Express Router (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
```typescript
import express from 'express'
import { createMetahubsServiceRoutes, initializeRateLimiters } from '@universo/metahubs-backend'

const app = express()
app.use(express.json())

await initializeRateLimiters()

app.use('/api/v1', createMetahubsServiceRoutes(ensureAuth, getDataSource))

app.listen(3000)
```

–ì–¥–µ:
- `ensureAuth` ‚Äî –≤–∞—à–µ middleware –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- `getDataSource` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç TypeORM `DataSource`

## –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ API

### –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã –º–µ—Ç–∞—Ö–∞–±–æ–≤
```http
GET    /metahubs                               # –°–ø–∏—Å–æ–∫ –º–µ—Ç–∞—Ö–∞–±–æ–≤
POST   /metahubs                               # –°–æ–∑–¥–∞—Ç—å –º–µ—Ç–∞—Ö–∞–±
GET    /metahubs/:metahubId                    # –ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏ –º–µ—Ç–∞—Ö–∞–±–∞
PUT    /metahubs/:metahubId                    # –û–±–Ω–æ–≤–∏—Ç—å –º–µ—Ç–∞—Ö–∞–±
DELETE /metahubs/:metahubId                    # –£–¥–∞–ª–∏—Ç—å –º–µ—Ç–∞—Ö–∞–± (CASCADE)

GET    /metahubs/:metahubId/members            # –°–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –º–µ—Ç–∞—Ö–∞–±–∞
POST   /metahubs/:metahubId/members            # –î–æ–±–∞–≤–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞
PATCH  /metahubs/:metahubId/members/:memberId  # –û–±–Ω–æ–≤–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞
DELETE /metahubs/:metahubId/members/:memberId  # –£–¥–∞–ª–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞
```

### –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã –º–µ—Ç–∞-—Ä–∞–∑–¥–µ–ª–æ–≤
```http
GET    /meta-sections                          # –°–ø–∏—Å–æ–∫ –º–µ—Ç–∞-—Ä–∞–∑–¥–µ–ª–æ–≤
POST   /meta-sections                          # –°–æ–∑–¥–∞—Ç—å –º–µ—Ç–∞-—Ä–∞–∑–¥–µ–ª (—Ç—Ä–µ–±—É–µ—Ç metahubId)
GET    /meta-sections/:id                      # –ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏ –º–µ—Ç–∞-—Ä–∞–∑–¥–µ–ª–∞
PUT    /meta-sections/:id                      # –û–±–Ω–æ–≤–∏—Ç—å –º–µ—Ç–∞-—Ä–∞–∑–¥–µ–ª
DELETE /meta-sections/:id                      # –£–¥–∞–ª–∏—Ç—å –º–µ—Ç–∞-—Ä–∞–∑–¥–µ–ª
```

### –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã –º–µ—Ç–∞-—Å—É—â–Ω–æ—Å—Ç–µ–π
```http
GET    /meta-entities                          # –°–ø–∏—Å–æ–∫ –º–µ—Ç–∞-—Å—É—â–Ω–æ—Å—Ç–µ–π
POST   /meta-entities                          # –°–æ–∑–¥–∞—Ç—å –º–µ—Ç–∞-—Å—É—â–Ω–æ—Å—Ç—å (—Ç—Ä–µ–±—É–µ—Ç sectionId, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ metahubId)
GET    /meta-entities/:id                      # –ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏ –º–µ—Ç–∞-—Å—É—â–Ω–æ—Å—Ç–∏
PUT    /meta-entities/:id                      # –û–±–Ω–æ–≤–∏—Ç—å –º–µ—Ç–∞-—Å—É—â–Ω–æ—Å—Ç—å
DELETE /meta-entities/:id                      # –£–¥–∞–ª–∏—Ç—å –º–µ—Ç–∞-—Å—É—â–Ω–æ—Å—Ç—å
```

### –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤/–æ—Ç–≤–µ—Ç–æ–≤

#### –°–æ–∑–¥–∞—Ç—å –º–µ—Ç–∞—Ö–∞–±
```http
POST /metahubs
Content-Type: application/json

{
  "name": "Gaming Hub",
  "description": "Virtual gaming worlds and assets"
}
```

–û—Ç–≤–µ—Ç:
```json
{
  "success": true,
  "data": {
    "id": "550e8400-e29b-41d4-a716-446655440000",
    "name": "Gaming Hub", 
    "description": "Virtual gaming worlds and assets",
    "createdAt": "2024-01-15T10:30:00Z",
    "updatedAt": "2024-01-15T10:30:00Z"
  }
}
```

#### –°–æ–∑–¥–∞—Ç—å –º–µ—Ç–∞-—Å—É—â–Ω–æ—Å—Ç—å —Å –ø—Ä–∏–≤—è–∑–∫–æ–π –∫ —Ä–∞–∑–¥–µ–ª—É
```http
POST /meta-entities
Content-Type: application/json

{
  "name": "Player Avatar",
  "description": "3D character model",
  "sectionId": "660e8400-e29b-41d4-a716-446655440001",
  "metahubId": "550e8400-e29b-41d4-a716-446655440000",
  "metadata": {
    "model": "character.fbx",
    "animations": ["idle", "walk", "run"]
  }
}
```

## –ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö

### –û—Å–Ω–æ–≤–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏ (–≤—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å)

- `Metahub`: –≤–µ—Ä—Ö–Ω–µ—É—Ä–æ–≤–Ω–µ–≤—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä.
- `MetaSection`: –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (–ø—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç—Å—è –∫ –º–µ—Ç–∞—Ö–∞–±–∞–º —á–µ—Ä–µ–∑ —Ç–∞–±–ª–∏—Ü—É —Å–≤—è–∑–µ–π).
- `MetaEntity`: –∞–∫—Ç–∏–≤/–æ–±—ä–µ–∫—Ç —Å –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º `metadata` (JSONB).
- `MetahubUser`: —á–ª–µ–Ω—Å—Ç–≤–æ —Å —Ä–æ–ª—è–º–∏ –∏ –ø—Ä–∞–≤–∞–º–∏.

### –¢–∞–±–ª–∏—Ü—ã —Å–≤—è–∑–µ–π

- `MetaSectionMetahub`: —Å–≤—è–∑—ã–≤–∞–µ—Ç –º–µ—Ç–∞-—Ä–∞–∑–¥–µ–ª—ã —Å –º–µ—Ç–∞—Ö–∞–±–∞–º–∏.
- `MetaEntityMetahub`: —Å–≤—è–∑—ã–≤–∞–µ—Ç –º–µ—Ç–∞-—Å—É—â–Ω–æ—Å—Ç–∏ —Å –º–µ—Ç–∞—Ö–∞–±–∞–º–∏.
- `MetaEntityMetaSection`: —Å–≤—è–∑—ã–≤–∞–µ—Ç –º–µ—Ç–∞-—Å—É—â–Ω–æ—Å—Ç–∏ —Å –º–µ—Ç–∞-—Ä–∞–∑–¥–µ–ª–∞–º–∏.

–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:
- –¢–∞–±–ª–∏—Ü—ã —Å–≤—è–∑–µ–π –∏—Å–ø–æ–ª—å–∑—É—é—Ç `UNIQUE` –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –ø–∞—Ä—ã –∏ `ON DELETE CASCADE` –¥–ª—è —Å—Å—ã–ª–æ—á–Ω–æ–π —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏.

## –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞

- `metahubId` –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –º–µ—Ç–∞-—Ä–∞–∑–¥–µ–ª–∞.
- `sectionId` –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –º–µ—Ç–∞-—Å—É—â–Ω–æ—Å—Ç–∏.
- `metahubId` –æ–ø—Ü–∏–æ–Ω–∞–ª–µ–Ω –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –º–µ—Ç–∞-—Å—É—â–Ω–æ—Å—Ç–∏ –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–∏–≤—è–∑–∫–∏ —Å—É—â–Ω–æ—Å—Ç–∏ –∫ –º–µ—Ç–∞—Ö–∞–±—É.
- UUID-–ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è, –∞ –¥–æ—Å—Ç—É–ø –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç—Å—è guard-–∞–º–∏.

## –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –ú–∏–≥—Ä–∞—Ü–∏–∏ –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å—É—â–Ω–æ—Å—Ç–µ–π

–°—É—â–Ω–æ—Å—Ç–∏ –∏ –º–∏–≥—Ä–∞—Ü–∏–∏ Metahubs —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è –≤ Flowise core backend:

```typescript
// flowise-core-backend/base/src/database/entities/index.ts
import { metahubsEntities } from '@universo/metahubs-backend'

// flowise-core-backend/base/src/database/migrations/postgres/index.ts
import { metahubsMigrations } from '@universo/metahubs-backend'
```

## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã
```bash
pnpm --filter @universo/metahubs-backend build
pnpm --filter @universo/metahubs-backend dev
pnpm --filter @universo/metahubs-backend test
pnpm --filter @universo/metahubs-backend lint
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```
src/
‚îú‚îÄ‚îÄ database/
‚îÇ   ‚îú‚îÄ‚îÄ entities/
‚îÇ   ‚îî‚îÄ‚îÄ migrations/
‚îú‚îÄ‚îÄ routes/
‚îú‚îÄ‚îÄ schemas/
‚îú‚îÄ‚îÄ tests/
‚îú‚îÄ‚îÄ types/
‚îú‚îÄ‚îÄ utils/
‚îî‚îÄ‚îÄ index.ts
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å `ensureMetahubAccess`, `ensureSectionAccess` –∏ `ensureEntityAccess`.
- Rate limiting –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ `initializeRateLimiters()`.

## –°–≤—è–∑–∞–Ω–Ω—ã–µ –ø–∞–∫–µ—Ç—ã
- [`@universo/metahubs-frontend`](../metahubs-frontend/base/README.md) - Frontend client
- [`@universo/auth-backend`](../auth-backend/base/README.md) - Authentication service
- [`@universo/utils`](../universo-utils/base/README.md) - Shared utilities

---
*–ß–∞—Å—Ç—å [Universo Platformo](../../../README.md)*
